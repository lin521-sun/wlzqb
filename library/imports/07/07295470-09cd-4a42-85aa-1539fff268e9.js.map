{"version":3,"sources":["assets\\script\\manager\\GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Created by carolsail \r\n\r\nimport Ball from \"../Ball\";\r\nimport Endpoint from \"../Endpoint\";\r\nimport Enemy from \"../Enemy\";\r\nimport { ENUM_AUDIO_CLIP, ENUM_GAME_EVENT, ENUM_GAME_STATUS, ENUM_UI_TYPE } from \"../Enum\";\r\nimport Food from \"../Food\";\r\nimport { Levels } from \"../Levels\";\r\nimport Player from \"../Player\";\r\nimport { StaticInstance } from \"../StaticInstance\";\r\nimport { clone, getRandom } from \"../Utils\";\r\nimport AudioManager from \"./AudioManager\";\r\nimport DataManager from \"./DataManager\";\r\nimport EventManager from \"./EventManager\";\r\nimport SdkManager from \"./SdkManager\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\ndeclare let tt: any;\r\ndeclare let wx: any;\r\n@ccclass\r\nexport default class GameManager extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    stageNode: cc.Node = null\r\n    @property([cc.Prefab])\r\n    bluePrefab: cc.Prefab[] = []\r\n    @property([cc.Prefab])\r\n    redPrefab: cc.Prefab[] = []\r\n    @property(cc.Prefab)\r\n    ballPrefab: cc.Prefab = null\r\n    @property(cc.Prefab)\r\n    foodPrefab: cc.Prefab = null\r\n    @property(cc.Prefab)\r\n    endpointPrefab: cc.Prefab = null\r\n    @property(cc.Label)\r\n    levelLabel: cc.Label = null\r\n\r\n    onLoad() {\r\n        EventManager.instance.on(ENUM_GAME_EVENT.GAME_RESTART, this.onGameRestart, this)\r\n        EventManager.instance.on(ENUM_GAME_EVENT.GAME_NEXT, this.onGameNext, this)\r\n        EventManager.instance.on(ENUM_GAME_EVENT.GAME_WIN, this.onGameWin, this)\r\n        EventManager.instance.on(ENUM_GAME_EVENT.GAME_LOSE, this.onGameLose, this)\r\n        EventManager.instance.on(ENUM_GAME_EVENT.PLAYER_SHOOT, this.onPlayerShoot, this)\r\n        EventManager.instance.on(ENUM_GAME_EVENT.GAME_VIBRATE, this.onVibrate, this)\r\n    }\r\n    /**\r\n     * 触发振动功能。\r\n     * 该方法首先检查是否存在名为\"tt\"的全局对象，如果是，则调用其vibrateLong方法进行长时间振动。\r\n     * 如果不存在\"tt\"对象，但存在名为\"wx\"的全局对象，则调用wx的vibrateLong方法进行长时间振动。\r\n     * 这种做法兼容了不同平台或框架中触发振动的API调用。\r\n     */\r\n    onVibrate() {\r\n        if (window[\"tt\"]) {\r\n            tt.vibrateLong({\r\n                success(res) {\r\n                    console.log(res);\r\n                },\r\n                fail(res) {\r\n                    console.log(`vibrateLong调用失败`);\r\n                },\r\n            });\r\n        }\r\n        else if (window[\"wx\"]) {\r\n            wx.vibrateLong({\r\n                success(res) {\r\n                    console.log(res);\r\n                },\r\n                fail(res) {\r\n                    console.log(`vibrateLong调用失败`);\r\n                },\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * 当游戏重新启动时调用此方法。\r\n     * \r\n     * 本方法负责触发数据管理器的重置操作，并初始化游戏。\r\n     * 它是游戏重启流程中的关键步骤，确保游戏状态被正确重置，\r\n     * 为新的游戏循环提供干净的数据环境。\r\n     */\r\n    onGameRestart() {\r\n        DataManager.instance.reset()\r\n        this.initGame()\r\n    }\r\n    /**\r\n     * 处理游戏进入下一关的操作。\r\n     * 当前关卡完成并满足进入下一关的条件后，此方法将被调用。\r\n     * 它主要负责更新关卡进度、重置数据并初始化下一关的游戏。\r\n     */\r\n    onGameNext() {\r\n        if (DataManager.instance.level < Levels.length) DataManager.instance.level++\r\n        DataManager.instance.reset()\r\n        this.initGame()\r\n    }\r\n    /**\r\n     * 处理游戏胜利时的逻辑。\r\n     * 停止记录游戏，检查是否完成所有关卡，更新游戏状态，播放胜利音效，并显示相应的UI。\r\n     * 如果当前关卡是最高关卡，则更新最高关卡记录。\r\n     */\r\n    onGameWin() {\r\n        StaticInstance.uiManager.stopRecord();\r\n        let maxLevel = DataManager.instance.level + 1\r\n        if (maxLevel > Levels.length) {\r\n            maxLevel = Levels.length\r\n            // 完成所有关卡\r\n            StaticInstance.uiManager.showCompleteNotice(true)\r\n        } else {\r\n            StaticInstance.uiManager.showCompleteNotice(false)\r\n        }\r\n        DataManager.instance.status = ENUM_GAME_STATUS.WIN\r\n        AudioManager.instance.playSound(ENUM_AUDIO_CLIP.WIN)\r\n        StaticInstance.uiManager.toggle(ENUM_UI_TYPE.WIN)\r\n\r\n        if (maxLevel > DataManager.instance.maxLevel) {\r\n            DataManager.instance.maxLevel = maxLevel\r\n            // 排行榜设置\r\n            // SdkManager.instance.setRankScore(maxLevel)\r\n        }\r\n    }\r\n    /**\r\n     * 初始化游戏的函数，负责设置游戏的初始状态，包括加载关卡数据、创建游戏场景中的对象等。\r\n     */\r\n    onGameLose(msg: string = '被抢断') {\r\n        StaticInstance.uiManager.stopRecord();\r\n        DataManager.instance.status = ENUM_GAME_STATUS.LOSE\r\n        AudioManager.instance.playSound(ENUM_AUDIO_CLIP.LOSE)\r\n        StaticInstance.uiManager.setLoseTitle(msg)\r\n        StaticInstance.uiManager.toggle(ENUM_UI_TYPE.LOSE)\r\n    }\r\n\r\n    initGame() {\r\n        DataManager.instance.status = ENUM_GAME_STATUS.INIT\r\n        let level = DataManager.instance.level\r\n        let current = DataManager.instance.currentData\r\n        if (!current) {\r\n            // 关卡数据\r\n            if (level > Levels.length) level = Levels.length\r\n            current = clone(Levels[level - 1])\r\n            if (!current['endpoint']) return\r\n            DataManager.instance.level = level\r\n            DataManager.instance.currentData = current\r\n        }\r\n\r\n        this.levelLabel.string = `${level}`\r\n        // 清除节点信息\r\n        this.stageNode.removeAllChildren()\r\n        // 初始化蓝方\r\n        for (let i = 0; i < current['blue'].length; i++) {\r\n            const data = current['blue'][i]\r\n            const blue: cc.Node = cc.instantiate(this.bluePrefab[0])\r\n            blue.parent = this.stageNode\r\n            const params = { x: data.x, y: data.y, angle: data.angle, status: data.status }\r\n            blue.getComponent(Player).init(params)\r\n            // 生成防守队员\r\n            if (data['red'] && data['red'].length) {\r\n                for (let j = 0; j < data['red'].length; j++) {\r\n                    if (!this.redPrefab) break\r\n                    const redData = data['red'][j]\r\n                    const red: cc.Node = cc.instantiate(this.redPrefab[0])\r\n                    red.parent = this.stageNode\r\n                    const redComp = red.getComponent(Enemy)\r\n                    redComp.setParent(data)\r\n                    redComp.init(redData)\r\n                }\r\n            }\r\n            // 生成增益道具\r\n            if (data['food'] && data['food'].length) {\r\n                for (let k = 0; k < data['food'].length; k++) {\r\n                    if (!this.foodPrefab) break\r\n                    const foodData = data['food'][k]\r\n                    const food: cc.Node = cc.instantiate(this.foodPrefab)\r\n                    food.parent = this.stageNode\r\n                    const redComp = food.getComponent(Food)\r\n                    redComp.setParent(data)\r\n                    redComp.init(foodData)\r\n                }\r\n            }\r\n        }\r\n        // 终点球门\r\n        const endpoint: cc.Node = cc.instantiate(this.endpointPrefab)\r\n        endpoint.parent = this.stageNode\r\n        endpoint.getComponent(Endpoint).init({ x: current['endpoint'].x, y: current['endpoint'].y, angle: current['endpoint'].angle })\r\n        if (current['endpoint']['red'].length) {\r\n            for (let j = 0; j < current['endpoint']['red'].length; j++) {\r\n                const redData = current['endpoint']['red'][j]\r\n                const red: cc.Node = cc.instantiate(this.redPrefab[0])\r\n                red.parent = this.stageNode\r\n                red.getComponent(Enemy).init(redData)\r\n            }\r\n        }\r\n        // 蓝方转向\r\n        const blueReady = DataManager.instance.getBlueReady()\r\n        const blueNext = DataManager.instance.getBlueNext()\r\n        if (blueNext) {\r\n            blueReady.turnTo(blueNext.x, blueNext.y)\r\n            blueNext.turnTo(blueReady.x, blueReady.y)\r\n            blueNext.setCircleActive(true)\r\n            // 摄像机移动\r\n            EventManager.instance.emit(ENUM_GAME_EVENT.CAMERA_MOVE, { current: blueReady, next: blueNext })\r\n        } else {\r\n            blueReady.turnTo(endpoint.x, endpoint.y)\r\n            // 摄像机移动\r\n            EventManager.instance.emit(ENUM_GAME_EVENT.CAMERA_MOVE, { current: blueReady, next: endpoint })\r\n        }\r\n        // 初始化技能条\r\n        StaticInstance.uiManager.setPowerBar()\r\n        // 设置对战队名\r\n        StaticInstance.uiManager.setTeamLabel()\r\n        // // 设置技能点\r\n        // StaticInstance.uiManager.setPropNum()\r\n        // 是否有提示\r\n        if (current['isTip']) {\r\n            StaticInstance.uiManager.setTip(level)\r\n            StaticInstance.uiManager.toggle(ENUM_UI_TYPE.TIP)\r\n        } else {\r\n            // 计时器开启\r\n            EventManager.instance.emit(ENUM_GAME_EVENT.TIMER_START)\r\n        }\r\n        // 初始化完毕\r\n        DataManager.instance.status = ENUM_GAME_STATUS.RUNING\r\n    }\r\n\r\n    /**\r\n     * 玩家射门\r\n     * 首先，它检查游戏状态是否为运行中（RUNING），如果不是，则直接返回，不执行任何操作。\r\n\r\n        接下来，将游戏状态设置为射击状态（SHOOTING）。\r\n\r\n        然后，播放开火声音（AUDIO_CLIP.SHOOT）。\r\n\r\n        从传入的数据中获取射击进度（progress）。\r\n\r\n        获取蓝色队伍的准备状态（getBlueReady）。\r\n\r\n        获取蓝色队伍的下一个目标位置（getBlueNext），如果传入的数据中包含下一个目标位置（next），则使用该位置代替默认的下一个目标位置。\r\n\r\n        如果蓝色队伍已准备就绪，则实例化一个足球对象（ball），将其父对象设置为舞台节点（stageNode）。\r\n\r\n        初始化足球对象的位置（x, y）。\r\n\r\n        根据是否有下一个目标位置，确定足球的移动终点。\r\n\r\n        调用足球对象的移动方法（move），传入起点、终点和射击进度，使足球开始移动。\r\n     */\r\n    onPlayerShoot(data: any) {\r\n        if (DataManager.instance.status != ENUM_GAME_STATUS.RUNING) return\r\n        DataManager.instance.status = ENUM_GAME_STATUS.SHOOTING\r\n        AudioManager.instance.playSound(ENUM_AUDIO_CLIP.SHOOT)\r\n\r\n        const progress = data.progress\r\n        const start = DataManager.instance.getBlueReady()\r\n        let next = DataManager.instance.getBlueNext()\r\n        if (data?.next) {\r\n            next = data.next\r\n        }\r\n        if (start) {\r\n            // start.shoot()\r\n            // 移动的足球\r\n            const ball: cc.Node = cc.instantiate(this.ballPrefab)\r\n            ball.parent = this.stageNode\r\n            let end = null\r\n            if (next) {\r\n                end = next\r\n            } else {\r\n                end = DataManager.instance.getEndpoint()\r\n            }\r\n            const ballCom = ball.getComponent(Ball)\r\n            ballCom.init({ x: start.x, y: start.y })\r\n            ballCom.move(start, end, progress)\r\n        }\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        EventManager.instance.off(ENUM_GAME_EVENT.GAME_RESTART, this.onGameRestart)\r\n        EventManager.instance.off(ENUM_GAME_EVENT.GAME_NEXT, this.onGameNext)\r\n        EventManager.instance.off(ENUM_GAME_EVENT.GAME_WIN, this.onGameWin)\r\n        EventManager.instance.off(ENUM_GAME_EVENT.GAME_LOSE, this.onGameLose)\r\n        EventManager.instance.off(ENUM_GAME_EVENT.PLAYER_SHOOT, this.onPlayerShoot)\r\n    }\r\n}\r\n"]}