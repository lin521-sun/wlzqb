{"version":3,"sources":["assets\\script\\Ball.ts"],"names":[],"mappings":";;;;;AAAA,wBAAwB;;;;;;;;;;;;;;;;;;;;;AAGxB,+BAA8G;AAC9G,uDAAkD;AAClD,qDAAgD;AAChD,uDAAkD;AAClD,mCAA8B;AAC9B,mDAAkD;AAE5C,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAAkC,wBAAY;IAA9C;QAAA,qEAoIC;QAhIG,WAAK,GAAW,IAAI,CAAA;QACpB,cAAQ,GAAW,GAAG,CAAA;;IA+H1B,CAAC;IA7HG,mBAAI,GAAJ,UAAK,IAAS;QACV,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;QACzB,IAAI,CAAC,MAAM,EAAE,CAAA;IACjB,CAAC;IAED,qBAAM,GAAN;QACI,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAA;IACzC,CAAC;IACD;;;;;OAKG;IACH,mBAAI,GAAJ,UAAK,KAAa,EAAE,GAAsB,EAAE,QAAgB;QAA5D,iBA8GC;QA7GG,OAAO;QACP,KAAK,CAAC,SAAS,CAAC,yBAAkB,CAAC,QAAQ,CAAC,CAAA;QAC5C,KAAK,CAAC,UAAU,EAAE,CAAA;QAClB,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,MAAM,GAAG,qBAAW,CAAC,QAAQ,CAAC,UAAU,IAAI,qBAAW,CAAC,QAAQ,CAAC,gBAAgB,CAAA;QACpH,IAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,WAAW,EAAE,CAAA;QACrC,IAAM,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,CAAA;QACnC,IAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,CAAA;QAErC,IAAI,SAAS,GAAG,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAA;QACrC,IAAI,QAAQ,IAAI,GAAG,IAAI,QAAQ,IAAI,GAAG,EAAE;YACpC,SAAS,GAAG,IAAI,CAAC,KAAK,GAAG,GAAG,CAAA;SAC/B;aAAM,IAAI,QAAQ,GAAG,GAAG,IAAI,QAAQ,IAAI,CAAC,EAAE;YACxC,MAAM;YACN,IAAI,qBAAW,CAAC,QAAQ,CAAC,UAAU,IAAI,qBAAW,CAAC,QAAQ,CAAC,gBAAgB,EAAE;gBAC1E,SAAS,GAAG,IAAI,CAAC,KAAK,CAAA;aACzB;iBAAM;gBACH,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAe,CAAC,GAAG,CAAC,CAAA;gBACpD,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAA;aAC5B;SACJ;QACD,IAAM,QAAQ,GAAG,QAAQ,GAAG,SAAS,CAAA;QAErC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,QAAQ,EAAE,EAAE,QAAQ,EAAE,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC;YAC1E,OAAO;YACP,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAe,CAAC,KAAK,CAAC,CAAA;YACtD,SAAS;YACT,KAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAA;YACnB,QAAQ;YACR,KAAK,CAAC,SAAS,CAAC,yBAAkB,CAAC,IAAI,CAAC,CAAA;YACxC,IAAI,GAAG,YAAY,gBAAM,EAAE;gBACvB,QAAQ;gBACR,GAAG,CAAC,SAAS,CAAC,yBAAkB,CAAC,KAAK,CAAC,CAAA;gBACvC,GAAG,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;gBAE1B,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAA;gBAChB,IAAM,IAAI,GAAG,qBAAW,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAA;gBAC/C,IAAI,IAAI,EAAE;oBACN,CAAC,GAAG,IAAI,CAAC,CAAC,CAAA;oBACV,CAAC,GAAG,IAAI,CAAC,CAAC,CAAA;oBACV,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAA;oBACzB,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;oBAC1B,OAAO;oBACP,sBAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,sBAAe,CAAC,WAAW,EAAE,EAAE,OAAO,EAAE,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAA;iBAC7F;qBAAM;oBACH,IAAM,QAAQ,GAAG,qBAAW,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAA;oBACnD,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAA;oBACd,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAA;oBACd,OAAO;oBACP,sBAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,sBAAe,CAAC,WAAW,EAAE,EAAE,OAAO,EAAE,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC,CAAA;iBACjG;gBACD,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;gBAChB,OAAO;gBACP,IAAI,QAAQ,GAAG,GAAG,IAAI,QAAQ,IAAI,CAAC;oBAAE,GAAG,CAAC,UAAU,EAAE,CAAA;aAExD;iBAAM;gBACH,SAAS;gBACT,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA;aAC1B;YAED,iBAAiB;YACjB,IAAI,qBAAW,CAAC,QAAQ,CAAC,MAAM,KAAK,uBAAgB,CAAC,QAAQ,EAAE;gBAC3D,qBAAW,CAAC,QAAQ,CAAC,MAAM,GAAG,uBAAgB,CAAC,MAAM,CAAA;gBACrD,OAAO;gBACP,IAAI,qBAAW,CAAC,QAAQ,CAAC,eAAe,IAAI,CAAC,EAAE;oBAC3C,OAAO;oBACP,IAAI,qBAAW,CAAC,QAAQ,CAAC,cAAc,IAAI,CAAC,EAAE;wBAC1C,qBAAW,CAAC,QAAQ,CAAC,UAAU,IAAI,CAAC,CAAA;wBACpC,IAAI,qBAAW,CAAC,QAAQ,CAAC,UAAU,GAAG,qBAAW,CAAC,QAAQ,CAAC,gBAAgB,EAAE;4BACzE,qBAAW,CAAC,QAAQ,CAAC,UAAU,GAAG,CAAC,CAAA;yBACtC;wBACD,+BAAc,CAAC,SAAS,CAAC,WAAW,EAAE,CAAA;qBACzC;yBAAM;wBACH,qBAAW,CAAC,QAAQ,CAAC,cAAc,IAAI,CAAC,CAAA;qBAC3C;iBACJ;qBAAM;oBACH,qBAAW,CAAC,QAAQ,CAAC,eAAe,IAAI,CAAC,CAAA;iBAC5C;gBAED,IAAI,qBAAW,CAAC,QAAQ,CAAC,UAAU,IAAI,qBAAW,CAAC,QAAQ,CAAC,gBAAgB,EAAE;oBAC1E,+BAAc,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,CAAC,CAAA;oBAC9C,+BAAc,CAAC,SAAS,CAAC,MAAM,CAAC,mBAAY,CAAC,MAAM,CAAC,CAAA;oBACpD,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAe,CAAC,KAAK,CAAC,CAAA;iBACzD;aACJ;YAED,KAAK;YACL,IAAI,QAAQ,GAAG,GAAG,IAAI,QAAQ,IAAI,GAAG,EAAE;gBACnC,+BAAc,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAA;gBAC7C,+BAAc,CAAC,SAAS,CAAC,MAAM,CAAC,mBAAY,CAAC,MAAM,CAAC,CAAA;gBACpD,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAe,CAAC,IAAI,CAAC,CAAA;aACxD;iBAAM,IAAI,QAAQ,GAAG,GAAG,IAAI,QAAQ,IAAI,IAAI,EAAE;gBAC3C,+BAAc,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAA;gBAC7C,+BAAc,CAAC,SAAS,CAAC,MAAM,CAAC,mBAAY,CAAC,MAAM,CAAC,CAAA;gBACpD,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAe,CAAC,KAAK,CAAC,CAAA;aACzD;iBAAM,IAAI,QAAQ,GAAG,IAAI,IAAI,QAAQ,IAAI,GAAG,EAAE;gBAC3C,+BAAc,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAA;gBAC7C,+BAAc,CAAC,SAAS,CAAC,MAAM,CAAC,mBAAY,CAAC,MAAM,CAAC,CAAA;gBACpD,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAe,CAAC,SAAS,CAAC,CAAA;aAC7D;iBAAM,IAAI,QAAQ,GAAG,GAAG,IAAI,QAAQ,IAAI,IAAI,EAAE;gBAC3C,+BAAc,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,CAAC,CAAA;gBAC9C,+BAAc,CAAC,SAAS,CAAC,MAAM,CAAC,mBAAY,CAAC,MAAM,CAAC,CAAA;gBACpD,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAe,CAAC,OAAO,CAAC,CAAA;aAC3D;iBAAM,IAAI,QAAQ,GAAG,IAAI,IAAI,QAAQ,IAAI,CAAC,EAAE;gBACzC,+BAAc,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,CAAC,CAAA;gBAC9C,+BAAc,CAAC,SAAS,CAAC,MAAM,CAAC,mBAAY,CAAC,MAAM,CAAC,CAAA;gBACpD,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,sBAAe,CAAC,YAAY,CAAC,CAAA;aAChE;QAEL,CAAC,CAAC,CAAC,KAAK,EAAE,CAAA;IACd,CAAC;IAnIgB,IAAI;QADxB,OAAO;OACa,IAAI,CAoIxB;IAAD,WAAC;CApID,AAoIC,CApIiC,EAAE,CAAC,SAAS,GAoI7C;kBApIoB,IAAI","file":"","sourceRoot":"/","sourcesContent":["// Created by carolsail \r\n\r\nimport Endpoint from \"./Endpoint\";\r\nimport { ENUM_AUDIO_CLIP, ENUM_GAME_EVENT, ENUM_GAME_STATUS, ENUM_PLAYER_STATUS, ENUM_UI_TYPE } from \"./Enum\";\r\nimport AudioManager from \"./manager/AudioManager\";\r\nimport DataManager from \"./manager/DataManager\";\r\nimport EventManager from \"./manager/EventManager\";\r\nimport Player from \"./Player\";\r\nimport { StaticInstance } from \"./StaticInstance\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Ball extends cc.Component {\r\n\r\n    x: number\r\n    y: number\r\n    speed: number = 3000\r\n    speedMin: number = 300\r\n\r\n    init(data: any) {\r\n        Object.assign(this, data)\r\n        this.rendor()\r\n    }\r\n\r\n    rendor() {\r\n        this.node.setPosition(this.x, this.y)\r\n    }\r\n    /**\r\n     * 控制足球移动的函数\r\n     * @param start 发起移动的球员\r\n     * @param end 移动的终点，可能是另一名球员或终点\r\n     * @param progress 移动的进度，用于计算移动速度和触发不同阶段的事件\r\n     */\r\n    move(start: Player, end: Player | Endpoint, progress: number) {\r\n        // 踢球状态\r\n        start.setStatus(ENUM_PLAYER_STATUS.SHOOTING)\r\n        start.playEffect()\r\n        this.node.getChildByName('Shield').active = DataManager.instance.powerCount >= DataManager.instance.powerCountTarget\r\n        const spos = start.node.getPosition()\r\n        const epos = end.node.getPosition()\r\n        const distance = spos.sub(epos).mag()\r\n\r\n        let moveSpeed = this.speed * progress\r\n        if (progress >= 0.5 && progress <= 0.7) {\r\n            moveSpeed = this.speed * 0.5\r\n        } else if (progress < 0.5 && progress >= 0) {\r\n            // 满能量\r\n            if (DataManager.instance.powerCount == DataManager.instance.powerCountTarget) {\r\n                moveSpeed = this.speed\r\n            } else {\r\n                AudioManager.instance.playSound(ENUM_AUDIO_CLIP.BOO)\r\n                moveSpeed = this.speedMin\r\n            }\r\n        }\r\n        const moveTime = distance / moveSpeed\r\n\r\n        cc.tween(this.node).to(moveTime, { position: cc.v3(epos.x, epos.y, 0) }).call(() => {\r\n            // 接球音效\r\n            AudioManager.instance.playSound(ENUM_AUDIO_CLIP.CATCH)\r\n            // 移动足球销毁\r\n            this.node.destroy()\r\n            // 回待机状态\r\n            start.setStatus(ENUM_PLAYER_STATUS.IDLE)\r\n            if (end instanceof Player) {\r\n                // 进持球状态\r\n                end.setStatus(ENUM_PLAYER_STATUS.READY)\r\n                end.setCircleActive(false)\r\n\r\n                let x = 0, y = 0\r\n                const next = DataManager.instance.getBlueNext()\r\n                if (next) {\r\n                    x = next.x\r\n                    y = next.y\r\n                    next.turnTo(end.x, end.y)\r\n                    next.setCircleActive(true)\r\n                    // 移动相机\r\n                    EventManager.instance.emit(ENUM_GAME_EVENT.CAMERA_MOVE, { current: end.node, next: next })\r\n                } else {\r\n                    const endpoint = DataManager.instance.getEndpoint()\r\n                    x = endpoint.x\r\n                    y = endpoint.y\r\n                    // 移动相机\r\n                    EventManager.instance.emit(ENUM_GAME_EVENT.CAMERA_MOVE, { current: end.node, next: endpoint })\r\n                }\r\n                end.turnTo(x, y)\r\n                // 接球效果\r\n                if (progress > 0.7 && progress <= 1) end.playEffect()\r\n\r\n            } else {\r\n                // 球门显示足球\r\n                end.setBallActive(true)\r\n            }\r\n\r\n            // 判断能量槽情况，游戏状态切换\r\n            if (DataManager.instance.status === ENUM_GAME_STATUS.SHOOTING) {\r\n                DataManager.instance.status = ENUM_GAME_STATUS.RUNING\r\n                // 技能饮品\r\n                if (DataManager.instance.powerEffectLoop <= 0) {\r\n                    // 增益食物\r\n                    if (DataManager.instance.foodEffectLoop <= 0) {\r\n                        DataManager.instance.powerCount += 1\r\n                        if (DataManager.instance.powerCount > DataManager.instance.powerCountTarget) {\r\n                            DataManager.instance.powerCount = 0\r\n                        }\r\n                        StaticInstance.uiManager.setPowerBar()\r\n                    } else {\r\n                        DataManager.instance.foodEffectLoop -= 1\r\n                    }\r\n                } else {\r\n                    DataManager.instance.powerEffectLoop -= 1\r\n                }\r\n\r\n                if (DataManager.instance.powerCount == DataManager.instance.powerCountTarget) {\r\n                    StaticInstance.uiManager.setNoticeLabel('必杀技')\r\n                    StaticInstance.uiManager.toggle(ENUM_UI_TYPE.NOTICE)\r\n                    AudioManager.instance.playSound(ENUM_AUDIO_CLIP.SKILL)\r\n                }\r\n            }\r\n\r\n            // 音效\r\n            if (progress > 0.7 && progress <= 0.8) {\r\n                StaticInstance.uiManager.setNoticeLabel('好球')\r\n                StaticInstance.uiManager.toggle(ENUM_UI_TYPE.NOTICE)\r\n                AudioManager.instance.playSound(ENUM_AUDIO_CLIP.GOOD)\r\n            } else if (progress > 0.8 && progress <= 0.85) {\r\n                StaticInstance.uiManager.setNoticeLabel('漂亮')\r\n                StaticInstance.uiManager.toggle(ENUM_UI_TYPE.NOTICE)\r\n                AudioManager.instance.playSound(ENUM_AUDIO_CLIP.GREAT)\r\n            } else if (progress > 0.85 && progress <= 0.9) {\r\n                StaticInstance.uiManager.setNoticeLabel('哇~')\r\n                StaticInstance.uiManager.toggle(ENUM_UI_TYPE.NOTICE)\r\n                AudioManager.instance.playSound(ENUM_AUDIO_CLIP.EXCELLENT)\r\n            } else if (progress > 0.9 && progress <= 0.95) {\r\n                StaticInstance.uiManager.setNoticeLabel('牛牛牛')\r\n                StaticInstance.uiManager.toggle(ENUM_UI_TYPE.NOTICE)\r\n                AudioManager.instance.playSound(ENUM_AUDIO_CLIP.AMAZING)\r\n            } else if (progress > 0.95 && progress <= 1) {\r\n                StaticInstance.uiManager.setNoticeLabel('世界波')\r\n                StaticInstance.uiManager.toggle(ENUM_UI_TYPE.NOTICE)\r\n                AudioManager.instance.playSound(ENUM_AUDIO_CLIP.UNBELIEVABLE)\r\n            }\r\n\r\n        }).start()\r\n    }\r\n}\r\n"]}